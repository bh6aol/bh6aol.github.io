<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>BH6AOL</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="BH6AOL">
<meta property="og:url" content="https://bh6aol.top/page/2/index.html">
<meta property="og:site_name" content="BH6AOL">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="BH6AOL">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="BH6AOL" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">BH6AOL</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">CQ CQ CQ, this is BH6AOL, calling CQ and standing by.</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS 订阅"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://bh6aol.top"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-多线程之生产者消费者问题" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/08/08/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B9%8B%E7%94%9F%E4%BA%A7%E8%80%85%E6%B6%88%E8%B4%B9%E8%80%85%E9%97%AE%E9%A2%98/" class="article-date">
  <time class="dt-published" datetime="2020-08-08T08:49:56.000Z" itemprop="datePublished">2020-08-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/08/08/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B9%8B%E7%94%9F%E4%BA%A7%E8%80%85%E6%B6%88%E8%B4%B9%E8%80%85%E9%97%AE%E9%A2%98/">多线程之生产者消费者问题</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>使用Linux平台的pthread库进行多线程编程实现生产者消费者问题。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;semaphore.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> P sem_wait</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> V sem_post</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">sem_t</span> empty;</span><br><span class="line"><span class="keyword">sem_t</span> full;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pthread_mutex_t</span> mutex;</span><br><span class="line"><span class="keyword">int</span> val = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">provider</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        P(&amp;empty);</span><br><span class="line">        pthread_mutex_lock(&amp;mutex);</span><br><span class="line">        val++;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;provider: provide one good!/now have %d\n&quot;</span>,val);</span><br><span class="line">        pthread_mutex_unlock(&amp;mutex);</span><br><span class="line">        V(&amp;full);</span><br><span class="line">        sleep(<span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">consumer</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        P(&amp;full);</span><br><span class="line">        pthread_mutex_lock(&amp;mutex);</span><br><span class="line">        val--;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;consumer: consume one good!/now have %d\n&quot;</span>,val);</span><br><span class="line">        pthread_mutex_unlock(&amp;mutex);</span><br><span class="line">        V(&amp;empty);</span><br><span class="line">        sleep(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> <span class="keyword">const</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    pthread_mutex_init(&amp;mutex,<span class="literal">NULL</span>);</span><br><span class="line">    sem_init(&amp;empty,<span class="number">0</span>,<span class="number">20</span>);</span><br><span class="line">    sem_init(&amp;full,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">pthread_t</span> t1;</span><br><span class="line">    <span class="keyword">pthread_t</span> t2;</span><br><span class="line">    pthread_create(&amp;t1,<span class="literal">NULL</span>,provider,<span class="literal">NULL</span>);</span><br><span class="line">    pthread_create(&amp;t1,<span class="literal">NULL</span>,consumer,<span class="literal">NULL</span>);</span><br><span class="line">    pthread_join(t1,<span class="literal">NULL</span>);  <span class="comment">// wiat t1 end</span></span><br><span class="line">    pthread_join(t2,<span class="literal">NULL</span>);  <span class="comment">// wait t2 end</span></span><br><span class="line">    pthread_mutex_destroy(&amp;mutex);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>定义了两个信号量full，empty和一个互斥变量mutex。其中full和empty用于实现同步，mutex用于实现互斥访问val进行存取（即改变val的值）。</p>
<p>由main方法中的**sem_init(&amp;empty,0,20)**可以看出val的取值范围为[0-20],程序开始时初始化val值为0，full为0，empty为20。然后起t1，t2两个线程分别为生产者和消费者线程。</p>
<ul>
<li>生产者线程主要是先申请（P)一个empty的空间然后互斥访问val进行生产（即val++）生产完成后释放（V）full表示val中已经有一个生产完成的资源了。</li>
<li>消费者线程主要是先申请（P)一个full的空间然后互斥访问val进行消费（即val–）消费完成后释放（V）empty表示val中已经有一个资源被消费了。</li>
</ul>
<p>由于消费者线程中sleep(3);而生产者线程中为slee(1);</p>
<p>所以执行结果为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">michael@DESKTOP-6N96H5I:&#x2F;mnt&#x2F;e&#x2F;test$ gcc threadTest.c -lpthread &amp;&amp; .&#x2F;a.out</span><br><span class="line">provider: provide one good!&#x2F;now have 1</span><br><span class="line">consumer: consume one good!&#x2F;now have 0</span><br><span class="line">provider: provide one good!&#x2F;now have 1</span><br><span class="line">consumer: consume one good!&#x2F;now have 0</span><br><span class="line">provider: provide one good!&#x2F;now have 1</span><br><span class="line">consumer: consume one good!&#x2F;now have 0</span><br><span class="line">provider: provide one good!&#x2F;now have 1</span><br><span class="line">consumer: consume one good!&#x2F;now have 0</span><br><span class="line">provider: provide one good!&#x2F;now have 1</span><br><span class="line">consumer: consume one good!&#x2F;now have 0</span><br><span class="line">provider: provide one good!&#x2F;now have 1</span><br><span class="line">consumer: consume one good!&#x2F;now have 0</span><br></pre></td></tr></table></figure>

<p>如果将其对调即消费者线程中sleep(1);而生产者线程中为slee(3);则执行结果为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">michael@DESKTOP-6N96H5I:&#x2F;mnt&#x2F;e&#x2F;test$ gcc threadTest.c -lpthread &amp;&amp; .&#x2F;a.out</span><br><span class="line">provider: provide one good!&#x2F;now have 1</span><br><span class="line">consumer: consume one good!&#x2F;now have 0</span><br><span class="line">provider: provide one good!&#x2F;now have 1</span><br><span class="line">provider: provide one good!&#x2F;now have 2</span><br><span class="line">consumer: consume one good!&#x2F;now have 1</span><br><span class="line">provider: provide one good!&#x2F;now have 2</span><br><span class="line">provider: provide one good!&#x2F;now have 3</span><br><span class="line">provider: provide one good!&#x2F;now have 4</span><br><span class="line">consumer: consume one good!&#x2F;now have 3</span><br><span class="line">provider: provide one good!&#x2F;now have 4</span><br><span class="line">provider: provide one good!&#x2F;now have 5</span><br><span class="line">provider: provide one good!&#x2F;now have 6</span><br><span class="line">consumer: consume one good!&#x2F;now have 5</span><br><span class="line">provider: provide one good!&#x2F;now have 6</span><br><span class="line">provider: provide one good!&#x2F;now have 7</span><br><span class="line">provider: provide one good!&#x2F;now have 8</span><br><span class="line">consumer: consume one good!&#x2F;now have 7</span><br><span class="line">provider: provide one good!&#x2F;now have 8</span><br><span class="line">provider: provide one good!&#x2F;now have 9</span><br><span class="line">provider: provide one good!&#x2F;now have 10</span><br><span class="line">consumer: consume one good!&#x2F;now have 9</span><br><span class="line">provider: provide one good!&#x2F;now have 10</span><br><span class="line">provider: provide one good!&#x2F;now have 11</span><br><span class="line">provider: provide one good!&#x2F;now have 12</span><br><span class="line">consumer: consume one good!&#x2F;now have 11</span><br><span class="line">provider: provide one good!&#x2F;now have 12</span><br><span class="line">provider: provide one good!&#x2F;now have 13</span><br><span class="line">provider: provide one good!&#x2F;now have 14</span><br><span class="line">consumer: consume one good!&#x2F;now have 13</span><br><span class="line">provider: provide one good!&#x2F;now have 14</span><br><span class="line">provider: provide one good!&#x2F;now have 15</span><br><span class="line">provider: provide one good!&#x2F;now have 16</span><br><span class="line">consumer: consume one good!&#x2F;now have 15</span><br><span class="line">provider: provide one good!&#x2F;now have 16</span><br><span class="line">provider: provide one good!&#x2F;now have 17</span><br><span class="line">provider: provide one good!&#x2F;now have 18</span><br><span class="line">consumer: consume one good!&#x2F;now have 17</span><br><span class="line">provider: provide one good!&#x2F;now have 18</span><br><span class="line">provider: provide one good!&#x2F;now have 19</span><br><span class="line">provider: provide one good!&#x2F;now have 20</span><br><span class="line">consumer: consume one good!&#x2F;now have 19</span><br><span class="line">provider: provide one good!&#x2F;now have 20</span><br><span class="line">consumer: consume one good!&#x2F;now have 19</span><br><span class="line">provider: provide one good!&#x2F;now have 20</span><br></pre></td></tr></table></figure>

<p>P.s.其实mutex也可以用semphore来定义即</p>
<p>sem_t mutex;</p>
<p>sem_init(&amp;mutex,0,1);</p>
<p>这样PV操作更加统一！</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://bh6aol.top/2020/08/08/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B9%8B%E7%94%9F%E4%BA%A7%E8%80%85%E6%B6%88%E8%B4%B9%E8%80%85%E9%97%AE%E9%A2%98/" data-id="cknhir5dk000j1wtv8cdle499" data-title="多线程之生产者消费者问题" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/c/" rel="tag">c</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/" rel="tag">linux</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-微信自动接听助手-WeChatAutoAnswer" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/05/03/%E5%BE%AE%E4%BF%A1%E8%87%AA%E5%8A%A8%E6%8E%A5%E5%90%AC%E5%8A%A9%E6%89%8B-WeChatAutoAnswer/" class="article-date">
  <time class="dt-published" datetime="2020-05-03T11:29:03.000Z" itemprop="datePublished">2020-05-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/05/03/%E5%BE%AE%E4%BF%A1%E8%87%AA%E5%8A%A8%E6%8E%A5%E5%90%AC%E5%8A%A9%E6%89%8B-WeChatAutoAnswer/">微信自动接听助手-WeChatAutoAnswer</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>因为以前使用的自动接听助手长期不更新已经不适配最新的微信版本（7.0.13）了。怨人不如自怨，求诸人不如求之己，所以决定自己来写一个微信自动接听助手。于是就有了今天的<strong>WeChatAutoAnswer ！</strong></p>
<p><strong>–&gt;<a target="_blank" rel="noopener" href="http://docs.sencom.top/wechatautoanswer/">使用手冊和下載地址</a>&lt;–</strong></p>
<p>那么就来看一下实(踩)现(坑)过程：首先我们学习一下AccessibilityService(使用搜索引擎就能找到许多入门教程)，这里我就不多赘述了。简单说就是通过AccessibilityService这个功能实现对微信应用的监听如果发现有视频通话请求就模拟点击接通即可。</p>
<p>1.1首先在manifest中注册一个service</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">service</span> <span class="attr">android:name</span>=<span class="string">&quot;.WeChatAccessibilityService&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:label</span>=<span class="string">&quot;@string/app_name&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:exported</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:permission</span>=<span class="string">&quot;android.permission.BIND_ACCESSIBILITY_SERVICE&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:process</span>=<span class="string">&quot;:BackgroundService&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;android.accessibilityservice.AccessibilityService&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">            &lt;meta-data</span><br><span class="line">                android:name=&quot;android.accessibilityservice&quot;</span><br><span class="line">                android:resource=&quot;@xml/accessible_service_config_ali&quot; /&gt;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">service</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>文件:xml/accessible_service_config_ali.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">accessibility-service</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:accessibilityEventTypes</span>=<span class="string">&quot;typeWindowStateChanged|typeWindowContentChanged|typeNotificationStateChanged&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:accessibilityFeedbackType</span>=<span class="string">&quot;feedbackGeneric&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:accessibilityFlags</span>=<span class="string">&quot;flagReportViewIds|flagRetrieveInteractiveWindows&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:canRetrieveWindowContent</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:notificationTimeout</span>=<span class="string">&quot;64&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:description</span>=<span class="string">&quot;@string/desc&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:canPerformGestures</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:packageNames</span>=<span class="string">&quot;com.tencent.mm&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>1.2然后写一个类继承AccessibilityService即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.sencom.wechatautoanswer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.accessibilityservice.AccessibilityService;</span><br><span class="line"><span class="keyword">import</span> android.annotation.SuppressLint;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">import</span> android.view.accessibility.AccessibilityEvent;</span><br><span class="line"><span class="keyword">import</span> android.view.accessibility.AccessibilityNodeInfo;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WeChatAccessibilityService</span> <span class="keyword">extends</span> <span class="title">AccessibilityService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">&quot;WeChatAccessibilityService&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressLint(&quot;LongLogTag&quot;)</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAccessibilityEvent</span><span class="params">(AccessibilityEvent event)</span> </span>&#123;</span><br><span class="line">        String pkgName = event.getPackageName().toString();</span><br><span class="line">        <span class="keyword">int</span> eventType = event.getEventType();</span><br><span class="line">        Log.d(TAG, <span class="string">&quot;onAccessibilityEvent:event:&quot;</span>+eventType);</span><br><span class="line">        <span class="keyword">switch</span> (eventType) &#123;</span><br><span class="line">            <span class="keyword">case</span> AccessibilityEvent.TYPE_WINDOW_STATE_CHANGED:</span><br><span class="line">                 <span class="keyword">try</span>&#123;</span><br><span class="line">                    AccessibilityNodeInfo info = event.getSource();</span><br><span class="line">                    String className = event.getClassName().toString();</span><br><span class="line">                    <span class="keyword">if</span>(className.equals(<span class="string">&quot;com.tencent.mm.plugin.voip.ui.VideoActivity&quot;</span>))&#123;</span><br><span class="line">                        autoAnswer();</span><br><span class="line">                    &#125;</span><br><span class="line">                    Log.d(TAG,<span class="string">&quot;CLASSNAME:&quot;</span>+ className);</span><br><span class="line">                &#125;<span class="keyword">catch</span> (Exception exx)&#123;</span><br><span class="line">                    exx.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressLint(&quot;LongLogTag&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">autoAnswer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        AccessibilityNodeInfo nodeInfo = getRootInActiveWindow();</span><br><span class="line">        <span class="keyword">if</span> (nodeInfo != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> child = nodeInfo.getChildCount();</span><br><span class="line">            <span class="comment">// iterate through all child of parent view</span></span><br><span class="line">            <span class="keyword">int</span> imCount = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;child; i++)&#123;</span><br><span class="line">                AccessibilityNodeInfo childNodeView = nodeInfo.getChild(i);</span><br><span class="line">                <span class="keyword">if</span>(childNodeView.getClassName().toString().equals(<span class="string">&quot;android.widget.ImageView&quot;</span>))&#123;</span><br><span class="line">                    <span class="keyword">if</span> (imCount == <span class="number">0</span> || imCount ==<span class="number">1</span>)&#123;</span><br><span class="line">                        imCount++;</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    childNodeView.performAction(AccessibilityNodeInfo.ACTION_CLICK);</span><br><span class="line">                  <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                Log.d(TAG,<span class="string">&quot;childNodeView:&quot;</span>+childNodeView.getClassName());</span><br><span class="line">                <span class="comment">// Do something with this window content</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onInterrupt</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里我们在监听器里面监听AccessibilityEvent.TYPE_WINDOW_STATE_CHANGED如果有窗口状态改变且切换到</p>
<p>com.tencent.mm.plugin.voip.ui.VideoActivity(怎么得到这个类名的？这里我通过adb命令查看当前显示的activity获得的)这个Acitvity时我们就可以调用 autoAnswer();方法然后在里面找到接听按钮点下去就OK</p>
<p><img src="/images/20200503223520-166x300.png" alt="img">光看autoAnswer()你可能会一头雾水，这里我制作了一个截图。通过代码可以看出我遍历整个子控件然后模拟点击了第三个android.widget.ImageView。那么为什么是第三个？我主要使用Log打印日志一个一个试出来的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">转语音childNodeView:android.widget.ImageView</span><br><span class="line">childNodeView:android.widget.TextView</span><br><span class="line">挂断childNodeView:android.widget.ImageView</span><br><span class="line">childNodeView:android.widget.TextView</span><br><span class="line">接听childNodeView:android.widget.ImageView</span><br><span class="line">childNodeView:android.widget.TextView</span><br><span class="line">缩小childNodeView:android.widget.Button</span><br><span class="line">childNodeView:android.widget.TextView</span><br></pre></td></tr></table></figure>

<p>通过对日志的分析，找出了第一个imageview是图中的绿色区域控件即转语音；第二个imageview是黄色区域的挂断，第三个imageview那个就是我们所需要的接听控件。这里为什么要自找控件位置主要是用uiautomatorviewer和DDMS 都不能分析上图界面的布局（报错）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Error obtaining UI hierarchy</span><br><span class="line">Error while obtaining UI hierarchy XML file: com.android.ddmlib.SyncException: Remote object doesn&#39;t exist!</span><br></pre></td></tr></table></figure>

<p>下载地址:</p>
<p>1.<a target="_blank" rel="noopener" href="http://home.sencom.top:8080/apps/WeChatAutoAnswer-2020-05-03.apk">http://home.sencom.top:8080/apps/WeChatAutoAnswer-2020-05-03.apk</a></p>
<p>2.<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1hcuOCx6CILIe70NPDornxg">https://pan.baidu.com/s/1hcuOCx6CILIe70NPDornxg</a> 提取码：tc15</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://bh6aol.top/2020/05/03/%E5%BE%AE%E4%BF%A1%E8%87%AA%E5%8A%A8%E6%8E%A5%E5%90%AC%E5%8A%A9%E6%89%8B-WeChatAutoAnswer/" data-id="cknhir5dl000k1wtv2k0p5ey3" data-title="微信自动接听助手-WeChatAutoAnswer" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/" rel="tag">android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/project/" rel="tag">project</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-raspberrypi-zero-wh-快速上手" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/04/30/raspberrypi-zero-wh-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/" class="article-date">
  <time class="dt-published" datetime="2020-04-30T11:36:12.000Z" itemprop="datePublished">2020-04-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/04/30/raspberrypi-zero-wh-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/">raspberrypi zero wh 快速上手</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="1-前言"><a href="#1-前言" class="headerlink" title="1.前言"></a>1.前言</h2><p>今天中午收到了几天前闲鱼购买的RaspberryPi Zero WH 。花了八十元，由于Zero 的USB接口全部为micro usb，显示输出为micro hdmi，所以别指望连显示器和键盘操作了（其实是要多花钱买转接线）</p>
<h2 id="2-操作步骤"><a href="#2-操作步骤" class="headerlink" title="2.操作步骤"></a>2.操作步骤</h2><h3 id="2-1首先我们需要："><a href="#2-1首先我们需要：" class="headerlink" title="2.1首先我们需要："></a><strong>2.1首先我们需要：</strong></h3><ul>
<li>RaspberryPi Zero WH</li>
<li>USB数据线一根</li>
<li>microSD卡一张</li>
<li>Linux操作系统的计算机一台（虚拟机也阔以）</li>
</ul>
<h3 id="2-2官网下载系统镜像"><a href="#2-2官网下载系统镜像" class="headerlink" title="2.2官网下载系统镜像"></a><strong>2.2官网下载系统镜像</strong></h3><p><a target="_blank" rel="noopener" href="https://www.raspberrypi.org/downloads/raspbian/%E8%BF%99%E9%87%8C%E6%88%91%E4%BB%AC%E9%80%89">https://www.raspberrypi.org/downloads/raspbian/这里我们选</a> Raspbian Buster  Lite，因为我不需要图形界面和其他推荐的软件，直接用最小系统是最好。但时间来到了2020.4.30号，使用官网最新的镜像已经不能通过配置文件的方式设置WIFI和ssh了，所以我们得下载旧的镜像，于是我对官网镜像下载地址进行了一波分析，发现<a target="_blank" rel="noopener" href="https://downloads.raspberrypi.org/raspbian_lite_latest%E5%8D%95%E5%87%BB%E6%AD%A4%E7%BD%91%E5%9D%80%E5%B0%B1%E7%9B%B4%E6%8E%A5%E9%BB%98%E8%AE%A4%E4%B8%8B%E8%BD%BD%E6%9C%80%E6%96%B0%E7%9A%84%E9%95%9C%E5%83%8F%E4%BA%86%EF%BC%8C%E4%BA%8E%E6%98%AF%E6%88%91%E5%87%AD%E5%80%9F%E7%9B%B4%E8%A7%89%E5%B0%86%E5%85%B6%E4%BF%AE%E6%94%B9%E6%88%90http://downloads.raspberrypi.org/raspbian_lite/">https://downloads.raspberrypi.org/raspbian_lite_latest单击此网址就直接默认下载最新的镜像了，于是我凭借直觉将其修改成http://downloads.raspberrypi.org/raspbian_lite/</a> NICE! 顺着点下去就找到了我知道的能够实现一根线配置的系统镜像<a target="_blank" rel="noopener" href="http://downloads.raspberrypi.org/raspbian_lite/images/raspbian_lite-2019-09-30/2019-09-26-raspbian-buster-lite.zip%E5%B0%86%E5%85%B6%E4%B8%8B%E8%BD%BD%E4%B8%8B%E6%9D%A5%E3%80%82%E4%BD%BF%E7%94%A8%E6%A0%91%E8%8E%93%E6%B4%BE%E5%AE%98%E6%96%B9%E6%8F%90%E4%BE%9B%E7%9A%84">http://downloads.raspberrypi.org/raspbian_lite/images/raspbian_lite-2019-09-30/2019-09-26-raspbian-buster-lite.zip将其下载下来。使用树莓派官方提供的</a> <strong>Raspberry Pi Imager</strong> 将刚刚下载的2019-09-26-raspbian-buster-lite.zip烧录到microSD卡中。</p>
<h3 id="2-3修改配置文件"><a href="#2-3修改配置文件" class="headerlink" title="2.3修改配置文件"></a><strong>2.3修改配置文件</strong></h3><p>使用Linux环境读取刚刚写好的MicroSD卡</p>
<p>2.3.1修改/etc/wpa_supplicant/wpa_supplicant.conf</p>
<p>追加以下wifi连接内容</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">network=&#123;</span><br><span class="line">    ssid=<span class="string">&quot;WiFi-Name&quot;</span> //wifi名称</span><br><span class="line">    psk=<span class="string">&quot;WiFi-password&quot;</span> //wifi密码</span><br><span class="line">    key_mgmt=WPA-PSK //加密方式</span><br><span class="line">    priority=1 //连接优先级，数字越大优先级越高（不可以是负数）</span><br><span class="line">    scan_ssid=1 //连接隐藏WiFi时需要指定该值为1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2.3.2在boot分区下新建一个名为ssh的文件</p>
<p>至此完成配置，将microSD卡插入zero然后加电等待zero自动连接到路由器（此时我们可以在路由器里获取到zero分配到的IP地址）</p>
<h2 id="3-基本优化"><a href="#3-基本优化" class="headerlink" title="3.基本优化"></a>3.基本优化</h2><h3 id="3-1通过ssh连接到我们的zero"><a href="#3-1通过ssh连接到我们的zero" class="headerlink" title="3.1通过ssh连接到我们的zero"></a><strong>3.1通过ssh连接到我们的zero</strong></h3><p>用户名:pi</p>
<p>密码:raspberry</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Windows PowerShell</span><br><span class="line">版权所有 (C) Microsoft Corporation。保留所有权利。</span><br><span class="line"></span><br><span class="line">尝试新的跨平台 PowerShell https:&#x2F;&#x2F;aka.ms&#x2F;pscore6</span><br><span class="line"></span><br><span class="line">PS C:\Users\michael&gt; ssh pi@192.168.1.11</span><br><span class="line">The authenticity of host &#39;192.168.1.11 (192.168.1.11)&#39; can&#39;t be established.</span><br><span class="line">ECDSA key fingerprint is SHA256:K7DB&#x2F;YjDroeIte87wQw&#x2F;c7O5PAamLJiKVpIk292j6DQ.</span><br><span class="line">Are you sure you want to continue connecting (yes&#x2F;no)? yes</span><br><span class="line">Warning: Permanently added &#39;192.168.1.11&#39; (ECDSA) to the list of known hosts.</span><br><span class="line">pi@192.168.1.11&#39;s password:</span><br><span class="line">Permission denied, please try again.</span><br><span class="line">pi@192.168.1.11&#39;s password:</span><br><span class="line">Linux raspberrypi 4.19.75+ #1270 Tue Sep 24 18:38:54 BST 2019 armv6l</span><br><span class="line"></span><br><span class="line">The programs included with the Debian GNU&#x2F;Linux system are free software;</span><br><span class="line">the exact distribution terms for each program are described in the</span><br><span class="line">individual files in &#x2F;usr&#x2F;share&#x2F;doc&#x2F;*&#x2F;copyright.</span><br><span class="line"></span><br><span class="line">Debian GNU&#x2F;Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span><br><span class="line">permitted by applicable law.</span><br><span class="line"></span><br><span class="line">SSH is enabled and the default password for the &#39;pi&#39; user has not been changed.</span><br><span class="line">This is a security risk - please login as the &#39;pi&#39; user and type &#39;passwd&#39; to set a new password.</span><br><span class="line"></span><br><span class="line">pi@raspberrypi:~ $ </span><br></pre></td></tr></table></figure>

<p>使用<code>sudo raspi-config</code>命令可配置密码、时区等。</p>
<h3 id="3-2更换源"><a href="#3-2更换源" class="headerlink" title="3.2更换源"></a><strong>3.2更换源</strong></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/apt/</span><br><span class="line">cat sources.list</span><br><span class="line">sudo cp sources.list sources.list.bak</span><br><span class="line">sudo sed -i &#x27;s|raspbian.raspberrypi.org|mirrors.ustc.edu.cn/raspbian|g&#x27; /etc/apt/sources.list</span><br><span class="line">cat sources.list</span><br><span class="line">cd sources.list.d/</span><br><span class="line">cat raspi.list </span><br><span class="line">sudo cp raspi.list raspi.list.bak</span><br><span class="line">sudo sed -i &#x27;s|//archive.raspberrypi.org|//mirrors.ustc.edu.cn/archive.raspberrypi.org|g&#x27; /etc/apt/sources.list.d/raspi.list</span><br><span class="line">cat raspi.list </span><br><span class="line">sudo apt update</span><br><span class="line">sudo apt upgrade</span><br><span class="line">sudo apt update</span><br><span class="line">sudo apt upgrade</span><br></pre></td></tr></table></figure>

<p>更新一下系统</p>
<h3 id="3-3解锁root用户"><a href="#3-3解锁root用户" class="headerlink" title="3.3解锁root用户"></a><strong>3.3解锁root用户</strong></h3><p>先使用<code>sudo passwd root</code>命令为root用户创建密码</p>
<p>使用<code>sudo passwd --unlock root</code>命令解锁root账户</p>
<p>===========================================</p>
<p>访问<a target="_blank" rel="noopener" href="http://home.sencom.top:8080/">http://home.sencom.top:8080/</a> 进入由树莓派zero搭建的home web server</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://bh6aol.top/2020/04/30/raspberrypi-zero-wh-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/" data-id="cknhir5dh000f1wtvgok864kc" data-title="raspberrypi zero wh 快速上手" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/raspberrypi/" rel="tag">raspberrypi</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-ADB发送中文到手机" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/04/23/ADB%E5%8F%91%E9%80%81%E4%B8%AD%E6%96%87%E5%88%B0%E6%89%8B%E6%9C%BA/" class="article-date">
  <time class="dt-published" datetime="2020-04-23T11:40:15.000Z" itemprop="datePublished">2020-04-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/04/23/ADB%E5%8F%91%E9%80%81%E4%B8%AD%E6%96%87%E5%88%B0%E6%89%8B%E6%9C%BA/">ADB发送中文到手机</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="1-何为ADB"><a href="#1-何为ADB" class="headerlink" title="1.何为ADB"></a>1.何为ADB</h2><p>Android 调试桥 (Android Debug Bridge, adb) 是一种功能多样的命令行工具，可让您与设备进行通信。adb  命令可用于执行各种设备操作（例如安装和调试应用），并提供对 Unix  shell（可用来在设备上运行各种命令）的访问权限。它是一种客户端-服务器程序，包括以下三个组件：<a target="_blank" rel="noopener" href="https://developer.android.google.cn/studio/command-line/adb">… …</a></p>
<h2 id="2-故事"><a href="#2-故事" class="headerlink" title="2.故事"></a>2.故事</h2><p>因为业务需求，需要使用adb命令模拟点击和填写文字（中文，英文，数字），adb发送文字大家都知道是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell input text &quot;Hello&quot;</span><br></pre></td></tr></table></figure>

<p>这样就可以将Hello推送到手机上当前对焦的如TextView等输入控件上。当时当我尝试如下命令就会出现无法推送到情况</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell input text &quot;你好&quot;</span><br></pre></td></tr></table></figure>

<p>通过搜索引擎得知目前adb因为设计的缺陷无法发送中文字符（unicode），于是又通过搜索引擎找到了一个开源工具<a target="_blank" rel="noopener" href="https://github.com/senzhk/ADBKeyBoard%EF%BC%8C%E9%80%9A%E8%BF%87%E5%AE%89%E8%A3%85%E6%AD%A4%E8%BE%93%E5%85%A5%E6%B3%95%E5%B9%B6%E5%B0%86%E5%85%B6%E8%AE%BE%E7%BD%AE%E4%B8%BA%E9%BB%98%E8%AE%A4%E8%BE%93%E5%85%A5%E6%B3%95%E5%8D%B3%E5%8F%AF%E9%80%9A%E8%BF%87adb%E6%96%B9%E5%BC%8F%E5%8F%91%E9%80%81%E4%B8%AD%E6%96%87%EF%BC%88%E8%BF%99%E9%87%8C%E6%B5%8B%E8%AF%95%E9%AD%85%E6%97%8F%E9%83%A8%E5%88%86%E6%9C%BA%E5%9E%8B%E6%97%A0%E6%B3%95%E4%BF%AE%E6%94%B9%E7%B3%BB%E7%BB%9F%E8%BE%93%E5%85%A5%E6%B3%95%EF%BC%8C%E7%B3%BB%E7%BB%9F%E7%89%88%E6%9C%ACFlyme">https://github.com/senzhk/ADBKeyBoard，通过安装此输入法并将其设置为默认输入法即可通过adb方式发送中文（这里测试魅族部分机型无法修改系统输入法，系统版本Flyme</a>  8.0.0.0A）华为部分机型可以设置，部分小米手机也可以，但是你要额外开启USB安全模式。接下来就是按照ADBKeyBoard给出的使用方法进行测试了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell am broadcast -a ADB_INPUT_TEXT --es msg &#39;你好嗎? Hello?&#39;</span><br></pre></td></tr></table></figure>

<p>然而，第一个用例就翻车了，出现了乱码，不过还好至少能有反应了。继续阅读，发现下面有类似将字符进行Base64编码后再丢给工具进行发送的例子如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">* For Mac&#x2F;Linux, you can use the latest base64 input type with base64 command line tool:</span><br><span class="line">adb shell am broadcast -a ADB_INPUT_B64 --es msg &#96;echo &#39;你好嗎? Hello?&#39; | base64&#96;</span><br></pre></td></tr></table></figure>

<p>但是很遗憾，我是Python3(Windows10)平台，于是得对这条命令进行改造在pyton中写一个汉字转base64编码的方法即可：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">def hans_to_base64(hans):</span><br><span class="line">    return base64.b64encode(hans.encode(&quot;utf-8&quot;)).decode()</span><br></pre></td></tr></table></figure>

<p>一行搞定，接下来只要在需要发送中文的地方进行如下调用即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">os.system(&quot;adb shell am broadcast -a ADB_INPUT_B64 --es msg &quot; + hans_to_base64(&quot;你好&quot;))</span><br></pre></td></tr></table></figure>

<h2 id="3-ABD常用命令"><a href="#3-ABD常用命令" class="headerlink" title="3.ABD常用命令"></a>3.ABD常用命令</h2><p><strong>1.adb devices</strong> , 获取设备列表及设备状态</p>
<p><strong>2.adb get-state</strong> , 获取设备的状态</p>
<ol>
<li>设备的状态有 3 钟，device , offline , unknown</li>
<li>device：设备正常连接</li>
<li>offline：连接出现异常，设备无响应</li>
<li>unknown：没有连接设备</li>
</ol>
<p>**3.**<strong>安装卸载应用程序</strong></p>
<p><strong>adb install</strong> <strong>用于安装</strong></p>
<ul>
<li>安装成功，返回成功提示 “Success”；</li>
<li>安装失败，会返回以下：</li>
<li>INSTALL_FAILED_ALREADY_EXISTS</li>
<li>此时需要用 -r 参数来重新安装。</li>
<li>INSTALL_FAILED_SIGNATURE_ERROR</li>
<li>应用的签名不一致，可能是发布版和调试版签名不同所致。也有可能是没卸载旧应用导致。</li>
<li>INSTALL_FAILED_INSUFFICIENT_STORAGE</li>
<li>存储空间不足，需要检查设备存储情况。</li>
</ul>
<p><strong>adb uninstall</strong> <strong>用于卸载</strong></p>
<ul>
<li>adb uninstall 后面带的是应用的包名，而不是应用名。</li>
<li>查看系统所有应用的包名：</li>
<li>adb shell pm list packages –f</li>
</ul>
<p><strong>4****．上传、下载文件</strong></p>
<ul>
<li>adb push 命令将PC机上的文件推到 DLT-RK3288 机器上；</li>
<li>adb pull 命令将DLT-RK3288机器上的文件拉到PC机上；</li>
<li>例如：</li>
<li>adb push d:/new.txt /sdcard/</li>
<li>将D盘下new.txt文件 推到内部存储器</li>
<li>adb pull /sdcard/new.txt  d:\</li>
<li>将DLT-RK3288 内部存储器根目录下的new.txt 拉到D盘</li>
</ul>
<p><strong>5. adb shell pm list package</strong> </p>
<p>Package Manager , 可以用获取到一些安装在 Android 设备上得应用信息</p>
<p>-s：列出系统应用</p>
<p>-f：列出应用包名及对应的apk名及存放位置</p>
<p><strong>5.adb shell</strong></p>
<p>通过adb shell 命令，就可以进入设备或者模拟器的shell环境了，在这个Linux shell中，我们就可以执行各种Linux命令了。</p>
<p>如果只想执行一条shell命令，就可以采用：adb shell [shell_command]，在实际使用中，经常与grep或findstr一起使用，起到过滤作用，查看自己需要的关键信息。</p>
<p><strong>6. 常见命令：</strong></p>
<p>如 ls, cd, rm, mkdir, touch, pwd, cp, mv, ifconfig, netstat, ping, ps, top等，进入adb shell即可执行，与linux相似</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://bh6aol.top/2020/04/23/ADB%E5%8F%91%E9%80%81%E4%B8%AD%E6%96%87%E5%88%B0%E6%89%8B%E6%9C%BA/" data-id="cknhir5cr00001wtv3tna3r68" data-title="ADB发送中文到手机" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/adb/" rel="tag">adb</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/" rel="tag">android</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-自制滚动歌词效果" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/04/21/%E8%87%AA%E5%88%B6%E6%BB%9A%E5%8A%A8%E6%AD%8C%E8%AF%8D%E6%95%88%E6%9E%9C/" class="article-date">
  <time class="dt-published" datetime="2020-04-21T11:44:55.000Z" itemprop="datePublished">2020-04-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/04/21/%E8%87%AA%E5%88%B6%E6%BB%9A%E5%8A%A8%E6%AD%8C%E8%AF%8D%E6%95%88%E6%9E%9C/">自制滚动歌词效果</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>最近一直在完善jayPlayer（自制杰伦播放器）当然不仅仅可以播放杰伦的歌曲，其他歌手也有哈。这次添加的是歌词滚动显示效果。废话不多说先上效果图：</p>
<p><img src="/images/S00421-22441842-495x1024.png" alt="img"></p>
<p>这个界面看上去还是阔以的，特别赞一下咪咕音乐的曲库，这首<strong>革命人永远是年轻</strong>  是我听过的最好的一版！远看这个布局也不怎么看出是如何实现的大概猜一个TextView？是的，就是TextView，每行歌词都是一个TextView，所有TextView都塞在一个ListView中，下面是我的布局文件：activity_play_lrc.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">FrameLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/play_lrc_frame&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;450dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:padding</span>=<span class="string">&quot;10dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintBottom_toTopOf</span>=<span class="string">&quot;@id/seek_bar_grid&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintEnd_toEndOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintTop_toBottomOf</span>=<span class="string">&quot;@id/nav_bar_grid&quot;</span>&gt;</span></span><br><span class="line">    &lt;ScrollView</span><br><span class="line">        android:id=&quot;@+id/play_lrc_scroll&quot;</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;match_parent&quot;</span><br><span class="line">        android:fillViewport=&quot;true&quot;</span><br><span class="line">        android:padding=&quot;5dp&quot;</span><br><span class="line">        android:scrollbars=&quot;none&quot;&gt;</span><br><span class="line">        &lt;ListView</span><br><span class="line">            android:scrollbars=&quot;none&quot;</span><br><span class="line">            android:id=&quot;@+id/play_lrc_listview&quot;</span><br><span class="line">            android:layout_width=&quot;match_parent&quot;</span><br><span class="line">            android:layout_height=&quot;match_parent&quot;</span><br><span class="line">            android:divider=&quot;#00000000&quot;</span><br><span class="line">            /&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ScrollView</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">FrameLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>和自定义适配器是一个思路，就是重新一个适配器LrcAdapter继承自BaseAdapter,并实现几个方法即可。再看一个布局文件就是ListView中每个人Item的布局，这里就简单点，是个TextView。</p>
<p>show_lrc_item.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line">&lt;LinearLayout</span><br><span class="line">    android:id=&quot;@+id/show_lrc_item&quot;</span><br><span class="line">    xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;&gt;</span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:id=&quot;@+id/play_lrc_view&quot;</span><br><span class="line">        android:textColor=&quot;#333333&quot;</span><br><span class="line">        android:textSize=&quot;20sp&quot;</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;match_parent&quot;</span><br><span class="line">        android:text=&quot;Hello this lrc yo~&quot;</span><br><span class="line">        android:textAlignment=&quot;center&quot; /&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后再写适配器LrcAdapter</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.sencom.jayplayer.adapter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.util.SparseBooleanArray;</span><br><span class="line"><span class="keyword">import</span> android.util.TypedValue;</span><br><span class="line"><span class="keyword">import</span> android.view.LayoutInflater;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.view.ViewGroup;</span><br><span class="line"><span class="keyword">import</span> android.widget.BaseAdapter;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> top.sencom.jayplayer.R;</span><br><span class="line"><span class="keyword">import</span> top.sencom.jayplayer.lrcparser.parser.Sentence;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LrcAdapter</span> <span class="keyword">extends</span> <span class="title">BaseAdapter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Sentence&gt; data;</span><br><span class="line">    <span class="keyword">private</span> LayoutInflater layoutInflater;</span><br><span class="line">    <span class="keyword">private</span> Context context;</span><br><span class="line">    <span class="keyword">private</span> SparseBooleanArray selected;</span><br><span class="line">    <span class="keyword">int</span> old = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LrcAdapter</span><span class="params">( Context context, List&lt;Sentence&gt; data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.data = data;</span><br><span class="line">        <span class="keyword">this</span>.layoutInflater = LayoutInflater.from(context);</span><br><span class="line">        <span class="keyword">this</span>.context = context;</span><br><span class="line">        <span class="keyword">this</span>.selected = <span class="keyword">new</span> SparseBooleanArray();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getItem</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data.get(position);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getItemId</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> position;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">getView</span><span class="params">(<span class="keyword">int</span> position, View convertView, ViewGroup parent)</span> </span>&#123;</span><br><span class="line">        convertView = layoutInflater.inflate(R.layout.show_lrc_item, <span class="keyword">null</span>);</span><br><span class="line">        TextView lrcLine = convertView.findViewById(R.id.play_lrc_view);</span><br><span class="line">        lrcLine.setText(data.get(position).getContent());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(selected.get(position))&#123;</span><br><span class="line">            lrcLine.setTextColor(context.getResources().getColor(R.color.colorPrimary));</span><br><span class="line">            lrcLine.setTextSize(TypedValue.COMPLEX_UNIT_SP,<span class="number">25</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            lrcLine.setTextColor(context.getResources().getColor(R.color.lrcDefault));</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> convertView;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSelectedItem</span><span class="params">(<span class="keyword">int</span> position)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(old!=-<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">this</span>.selected.put(old,<span class="keyword">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.selected.put(position,<span class="keyword">true</span>);</span><br><span class="line">        old = position;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里我们设置了一个SparseBooleanArray  用来存放当前选中的Item的标志；用于实现当前播放行的字体加大和上色，相关方法是getView()和setSelectedItem()，old变量用来记忆上一个被选中的Item用于恢复。其实也可以不用因为都是顺序的完全可以通过-1得到。注意这里的数据data变量的类型是List<Sentence>，这里我的歌词解析用的是github上的<a target="_blank" rel="noopener" href="https://github.com/authorfu/LrcParser%E4%BD%86%E6%98%AF%E4%BB%96%E7%9A%84%E4%BB%A3%E7%A0%81%E6%9C%89%E4%B8%AA%E5%B0%8Fbug%EF%BC%8C%E6%97%A9%E5%9C%A8%E6%88%91%E5%86%99%E5%9F%BA%E4%BA%8Ejava">https://github.com/authorfu/LrcParser但是他的代码有个小bug，早在我写基于java</a> swing GUI开发的音乐播放器时候就发现并解决了，所以这次直接改了就用就行了。</p>
<p>接下来就是activity中的核心代码了，当然之前应该已经将歌词lrc文件获取到，并将其存放在reader变量中。下面给出lrc显示线程的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">lrcT =  <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line">                    lyric= LrcParser.create(reader);</span><br><span class="line">                &#125;<span class="keyword">catch</span>(IOException e)&#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">while</span> (<span class="keyword">true</span>)&#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Thread.sleep(<span class="number">256</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                    Sentence sentence=lyric.findSentence(mediaPlayer.getCurrentPosition());</span><br><span class="line">                   <span class="keyword">try</span> &#123;</span><br><span class="line">                       <span class="keyword">if</span>(sentence.getIndex() == lyric.getSize() || lrcExit)&#123;</span><br><span class="line">                           <span class="keyword">break</span>;</span><br><span class="line">                       &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                           <span class="comment">//System.out.println(sentence);</span></span><br><span class="line">                           runOnUiThread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                               <span class="meta">@Override</span></span><br><span class="line">                               <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                                   lrcListView.post(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                                       <span class="meta">@Override</span></span><br><span class="line">                                       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                                           lrcAdapter.setSelectedItem(sentence.getIndex());</span><br><span class="line">                                           lrcAdapter.notifyDataSetChanged();</span><br><span class="line">                                           lrcListView.setSelectionFromTop(sentence.getIndex(),<span class="number">550</span>);</span><br><span class="line">                                       &#125;</span><br><span class="line">                                   &#125;);</span><br><span class="line">                               &#125;</span><br><span class="line">                           &#125;);</span><br><span class="line">                       &#125;</span><br><span class="line">                   &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">                       <span class="keyword">break</span>;</span><br><span class="line">                   &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>在歌词准备好，listview添加好适配器后就可以启动这个线程，其中核心代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">runOnUiThread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                               <span class="meta">@Override</span></span><br><span class="line">                               <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                                   lrcListView.post(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                                       <span class="meta">@Override</span></span><br><span class="line">                                       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                                           lrcAdapter.setSelectedItem(sentence.getIndex());</span><br><span class="line">                                           lrcAdapter.notifyDataSetChanged();</span><br><span class="line">                                           lrcListView.setSelectionFromTop(sentence.getIndex(),<span class="number">550</span>);</span><br><span class="line">                                       &#125;</span><br><span class="line">                                   &#125;);</span><br><span class="line">                               &#125;</span><br><span class="line">                           &#125;);</span><br></pre></td></tr></table></figure>

<p>每次执行此方法时首先将选中的Item调整为当前播放的歌曲所匹配的歌词，然后通知listview数据集有改动这样listview就会重新绘制布局执行getView方法将旧的歌词恢复，新的歌词变大上色，最后执行listview选中方法将当前位置的歌词滚动到屏幕相对中间的地方，至此完成一行歌词显示。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://bh6aol.top/2020/04/21/%E8%87%AA%E5%88%B6%E6%BB%9A%E5%8A%A8%E6%AD%8C%E8%AF%8D%E6%95%88%E6%9E%9C/" data-id="cknhir5dm000m1wtvhik9cqdi" data-title="自制滚动歌词效果" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/" rel="tag">android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/" rel="tag">java</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-自定义ListView适配器" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/04/18/%E8%87%AA%E5%AE%9A%E4%B9%89ListView%E9%80%82%E9%85%8D%E5%99%A8/" class="article-date">
  <time class="dt-published" datetime="2020-04-18T11:51:14.000Z" itemprop="datePublished">2020-04-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/04/18/%E8%87%AA%E5%AE%9A%E4%B9%89ListView%E9%80%82%E9%85%8D%E5%99%A8/">自定义ListView适配器</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>最近想写一个音乐播放器作为安卓课程验收作业；于是拿起早些时候写的一个jayPlayer准备魔改一下，这个App使用的音乐资源来自Github上<a target="_blank" rel="noopener" href="https://github.com/jsososo/MiguMusicApi%E7%94%A8%E7%9A%84%E6%98%AF%E5%92%AA%E5%92%95%E9%9F%B3%E4%B9%90%E7%9A%84API%EF%BC%8C%E6%89%80%E4%BB%A5%E5%8F%AF%E4%BB%A5%E6%92%AD%E6%94%BE%E6%9D%B0%E4%BC%A6%E7%9A%84%E6%AD%8C%E3%80%82">https://github.com/jsososo/MiguMusicApi用的是咪咕音乐的API，所以可以播放杰伦的歌。</a></p>
<p>书归正传，先看效果图</p>
<p><img src="/images/20200418221640.png" alt="img"></p>
<p>如图所示，每个搜索结果为一行大字和一行小字。其中大字是歌曲名；小字是歌手和专辑名。这种简单的两行显示其实安卓自身就有</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android.R.layout.simple_list_item_2</span><br></pre></td></tr></table></figure>

<p>这个布局就是显示两个的。但是如果还要显示一张图片就不行了，由此引入本次主题，既然你能造这个我也能模仿造一个出来。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;ScrollView</span><br><span class="line">            android:id=&quot;@+id/scrollView&quot;</span><br><span class="line">            app:layout_constraintTop_toBottomOf=&quot;@+id/grid&quot;</span><br><span class="line">            app:layout_constraintLeft_toLeftOf=&quot;parent&quot;</span><br><span class="line">            app:layout_constraintBottom_toBottomOf=&quot;parent&quot;</span><br><span class="line">            android:layout_width=&quot;match_parent&quot;</span><br><span class="line">            android:layout_height=&quot;match_parent&quot;</span><br><span class="line">            android:fillViewport=&quot;true&quot;</span><br><span class="line">            android:scrollbars=&quot;vertical&quot;&gt;</span><br><span class="line">                &lt;ListView</span><br><span class="line">                    android:id=&quot;@+id/listview&quot;</span><br><span class="line">                    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">                    android:layout_height=&quot;match_parent&quot;</span><br><span class="line">                    /&gt;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">ScrollView</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这是下方搜索结果的布局文件，其中我们定义了一个listview.</p>
<p>下面是重写适配器部分，先看一下用到的ShowItem类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.sencom.jayplayer.model;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShowItem</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String albumName;</span><br><span class="line">    <span class="keyword">private</span> String artistName;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ShowItem</span><span class="params">(String name, String albumName, String artistName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.albumName = albumName;</span><br><span class="line">        <span class="keyword">this</span>.artistName = artistName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getAlbumName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> albumName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAlbumName</span><span class="params">(String albumName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.albumName = albumName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getArtistName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> artistName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setArtistName</span><span class="params">(String artistName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.artistName = artistName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  name + <span class="string">&#x27;\n&#x27;</span> + albumName + <span class="string">&#x27;/&#x27;</span> + artistName ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.sencom.jayplayer.adapter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.view.LayoutInflater;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.view.ViewGroup;</span><br><span class="line"><span class="keyword">import</span> android.widget.BaseAdapter;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> top.sencom.jayplayer.R;</span><br><span class="line"><span class="keyword">import</span> top.sencom.jayplayer.model.ShowItem;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SearchResultAdapter</span> <span class="keyword">extends</span> <span class="title">BaseAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;ShowItem&gt; data;</span><br><span class="line">    <span class="keyword">private</span> LayoutInflater layoutInflater;</span><br><span class="line">    <span class="keyword">private</span> Context context;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SearchResultAdapter</span><span class="params">(Context context, List&lt;ShowItem&gt; data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.context = context;</span><br><span class="line">        <span class="keyword">this</span>.data = data;</span><br><span class="line">        <span class="keyword">this</span>.layoutInflater = LayoutInflater.from(context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Info</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> TextView fristLine;</span><br><span class="line">        <span class="keyword">public</span> TextView secondLine;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getItem</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data.get(position);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getItemId</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> position;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">getView</span><span class="params">(<span class="keyword">int</span> position, View convertView, ViewGroup parent)</span> </span>&#123;</span><br><span class="line">        Info info = <span class="keyword">new</span> Info();</span><br><span class="line">        convertView = layoutInflater.inflate(R.layout.show_each_item, <span class="keyword">null</span>);</span><br><span class="line">        info.fristLine = convertView.findViewById(R.id.first_line);</span><br><span class="line">        info.secondLine = convertView.findViewById(R.id.second_line);</span><br><span class="line"></span><br><span class="line">        info.fristLine.setText(data.get(position).getName());</span><br><span class="line">        info.secondLine.setText(data.get(position).getArtistName()+<span class="string">&quot;-&quot;</span>+data.get(position).getAlbumName());</span><br><span class="line">        <span class="keyword">return</span> convertView;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面自定义适配器核心代码就是getView方法的重写，大概过程就是从R.layout.show_each_item布局文件中加载View，然后为其中的控件赋值，最后返回这个自定义View。</p>
<p>下面是R.layout.show_each_item布局文件</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span><br><span class="line">&lt;LinearLayout</span><br><span class="line">    android:id=<span class="string">&quot;@+id/show_each_item&quot;</span></span><br><span class="line">    xmlns:android=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span> android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">    android:layout_height=<span class="string">&quot;match_parent&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;GridLayout</span><br><span class="line">        android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">        android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">        android:orientation=<span class="string">&quot;vertical&quot;</span></span><br><span class="line">        android:rowCount=<span class="string">&quot;2&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">        &lt;TextView</span><br><span class="line">            android:layout_marginLeft=<span class="string">&quot;10dp&quot;</span></span><br><span class="line">            android:id=<span class="string">&quot;@+id/first_line&quot;</span></span><br><span class="line">            android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">            android:textSize=<span class="string">&quot;23dp&quot;</span></span><br><span class="line">            android:text=<span class="string">&quot;SongName&quot;</span></span><br><span class="line">            android:textColor=<span class="string">&quot;#444&quot;</span></span><br><span class="line">            /&gt;</span><br><span class="line">        &lt;TextView</span><br><span class="line">            android:layout_marginLeft=<span class="string">&quot;10dp&quot;</span></span><br><span class="line">            android:id=<span class="string">&quot;@+id/second_line&quot;</span></span><br><span class="line">            android:text=<span class="string">&quot;Arits-Album&quot;</span></span><br><span class="line">            android:layout_width=<span class="string">&quot;match_parent&quot;</span>/&gt;</span><br><span class="line">    &lt;/GridLayout&gt;</span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure>

<p>最后我们在Activity中编写如下代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">listView = findViewById(R.id.listview);</span><br><span class="line">List&lt;ShowItem&gt; showItem = <span class="keyword">new</span> ArrayList&lt;ShowItem&gt;();</span><br><span class="line"><span class="comment">// 赋值showItem</span></span><br><span class="line">SearchResultAdapter searchResultAdapter = <span class="keyword">new</span> SearchResultAdapter(MainActivity.<span class="keyword">this</span>,showItem);</span><br><span class="line">listView.setAdapter(searchResultAdapter);</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="https://bh6aol.top/2020/04/18/%E8%87%AA%E5%AE%9A%E4%B9%89ListView%E9%80%82%E9%85%8D%E5%99%A8/" data-id="cknhir5dn000o1wtv8ly55eep" data-title="自定义ListView适配器" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/" rel="tag">android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/" rel="tag">java</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Android-GridLayout-自適應" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/04/11/Android-GridLayout-%E8%87%AA%E9%81%A9%E6%87%89/" class="article-date">
  <time class="dt-published" datetime="2020-04-11T13:12:53.000Z" itemprop="datePublished">2020-04-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/04/11/Android-GridLayout-%E8%87%AA%E9%81%A9%E6%87%89/">Android GridLayout 自適應</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>最近趁著學習安卓開發，順便將去年暑假就想寫的Loan項目快速構建一下。想寫個菜單界面。決定用網格佈局試一試，但是網友普遍對網格佈局不看好。可能是因爲早期的網格佈局不支持權重的原因吧？總之今天就記錄一下我的踩坑過程。</p>
<p>首先看一下xml佈局文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">FrameLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:context</span>=<span class="string">&quot;.MenuActivity&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">&quot;horizontal&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:background</span>=<span class="string">&quot;#EEEEEE&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    &lt;GridLayout</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;match_parent&quot;</span><br><span class="line">        android:orientation=&quot;horizontal&quot;</span><br><span class="line">        android:columnCount=&quot;3&quot;&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &lt;Button</span><br><span class="line">            android:id=&quot;@+id/contract_btu&quot;</span><br><span class="line">            android:layout_width=&quot;0dp&quot;</span><br><span class="line">            android:layout_columnWeight=&quot;1&quot;</span><br><span class="line">            android:layout_marginLeft=&quot;10dp&quot;</span><br><span class="line">            android:layout_marginRight=&quot;10dp&quot;</span><br><span class="line">            android:layout_marginTop=&quot;20dp&quot;</span><br><span class="line">            android:background=&quot;@drawable/selector_contract&quot; /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;Button</span><br><span class="line">            android:id=&quot;@+id/invoice_btu&quot;</span><br><span class="line">            android:layout_width=&quot;0dp&quot;</span><br><span class="line">            android:layout_columnWeight=&quot;1&quot;</span><br><span class="line">            android:layout_marginLeft=&quot;10dp&quot;</span><br><span class="line">            android:layout_marginRight=&quot;10dp&quot;</span><br><span class="line">            android:layout_marginTop=&quot;20dp&quot;</span><br><span class="line">            android:background=&quot;@drawable/selector_invoice&quot; /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;Button</span><br><span class="line">            android:id=&quot;@+id/record_btu&quot;</span><br><span class="line">            android:layout_width=&quot;0dp&quot;</span><br><span class="line">            android:layout_columnWeight=&quot;1&quot;</span><br><span class="line">            android:layout_marginLeft=&quot;10dp&quot;</span><br><span class="line">            android:layout_marginRight=&quot;10dp&quot;</span><br><span class="line">            android:layout_marginTop=&quot;20dp&quot;</span><br><span class="line">            android:background=&quot;@drawable/selector_record&quot; /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;TextView</span><br><span class="line">            android:layout_width=&quot;0dp&quot;</span><br><span class="line">            android:layout_columnWeight=&quot;1&quot;</span><br><span class="line">            android:layout_marginLeft=&quot;10dp&quot;</span><br><span class="line">            android:layout_marginRight=&quot;10dp&quot;</span><br><span class="line">            android:gravity=&quot;center&quot;</span><br><span class="line">            android:text=&quot;我的合同&quot; /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;TextView</span><br><span class="line">            android:layout_width=&quot;0dp&quot;</span><br><span class="line">            android:layout_columnWeight=&quot;1&quot;</span><br><span class="line">            android:layout_marginLeft=&quot;10dp&quot;</span><br><span class="line">            android:layout_marginRight=&quot;10dp&quot;</span><br><span class="line">            android:gravity=&quot;center&quot;</span><br><span class="line">            android:text=&quot;借據詳情&quot; /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;TextView</span><br><span class="line">            android:layout_width=&quot;0dp&quot;</span><br><span class="line">            android:layout_columnWeight=&quot;1&quot;</span><br><span class="line">            android:layout_marginLeft=&quot;10dp&quot;</span><br><span class="line">            android:layout_marginRight=&quot;10dp&quot;</span><br><span class="line">            android:gravity=&quot;center&quot;</span><br><span class="line">            android:text=&quot;還款記錄&quot; /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;Button</span><br><span class="line">            android:id=&quot;@+id/planning_btu&quot;</span><br><span class="line">            android:layout_width=&quot;0dp&quot;</span><br><span class="line">            android:layout_columnWeight=&quot;1&quot;</span><br><span class="line">            android:layout_marginLeft=&quot;10dp&quot;</span><br><span class="line">            android:layout_marginRight=&quot;10dp&quot;</span><br><span class="line">            android:layout_marginTop=&quot;20dp&quot;</span><br><span class="line">            android:background=&quot;@drawable/selector_planning&quot; /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;Button</span><br><span class="line">            android:id=&quot;@+id/software_btu&quot;</span><br><span class="line">            android:layout_width=&quot;0dp&quot;</span><br><span class="line">            android:layout_columnWeight=&quot;1&quot;</span><br><span class="line">            android:layout_marginLeft=&quot;10dp&quot;</span><br><span class="line">            android:layout_marginRight=&quot;10dp&quot;</span><br><span class="line">            android:layout_marginTop=&quot;20dp&quot;</span><br><span class="line">            android:background=&quot;@drawable/selector_software&quot; /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;Button</span><br><span class="line">            android:id=&quot;@+id/more_btu&quot;</span><br><span class="line">            android:layout_width=&quot;0dp&quot;</span><br><span class="line">            android:layout_columnWeight=&quot;1&quot;</span><br><span class="line">            android:layout_marginLeft=&quot;10dp&quot;</span><br><span class="line">            android:layout_marginRight=&quot;10dp&quot;</span><br><span class="line">            android:layout_marginTop=&quot;20dp&quot;</span><br><span class="line">            android:background=&quot;@drawable/selector_more&quot; /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;TextView</span><br><span class="line">            android:layout_width=&quot;0dp&quot;</span><br><span class="line">            android:layout_columnWeight=&quot;1&quot;</span><br><span class="line">            android:layout_marginLeft=&quot;10dp&quot;</span><br><span class="line">            android:layout_marginRight=&quot;10dp&quot;</span><br><span class="line">            android:gravity=&quot;center&quot;</span><br><span class="line">            android:text=&quot;還款計劃&quot; /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;TextView</span><br><span class="line">            android:layout_width=&quot;0dp&quot;</span><br><span class="line">            android:layout_columnWeight=&quot;1&quot;</span><br><span class="line">            android:layout_marginLeft=&quot;10dp&quot;</span><br><span class="line">            android:layout_marginRight=&quot;10dp&quot;</span><br><span class="line">            android:gravity=&quot;center&quot;</span><br><span class="line">            android:text=&quot;軟件信息&quot; /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;TextView</span><br><span class="line">            android:layout_width=&quot;0dp&quot;</span><br><span class="line">            android:layout_columnWeight=&quot;1&quot;</span><br><span class="line">            android:layout_marginLeft=&quot;10dp&quot;</span><br><span class="line">            android:layout_marginRight=&quot;10dp&quot;</span><br><span class="line">            android:gravity=&quot;center&quot;</span><br><span class="line">            android:text=&quot;更多工具&quot; /&gt;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">GridLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">FrameLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/images/20200411215223.png" alt="img"></p>
<p>如左圖所示，采用三列的網格，行數沒有固定，其中圖標和圖標下面的文字是等價的，都屬於網格裏面的元素。其中的關鍵點就是將所有網格中的元素列權重全部設置為1，讓它們權重一隻。還有就是設置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android:layout_width=&quot;0dp&quot;</span><br></pre></td></tr></table></figure>

<p>此屬性是將控件的佈局寬度設置為0，這樣網格佈局就可以等距自適應的排列内部的控件了。</p>
<p>———分割綫————-</p>
<p>順便提一下，在寫還貸計劃這個子Actively的時候發現Android沒有什麽好用的表格控件，看了幾個github上面的開源項目感覺有點複雜。這是我突然想到了上次折騰小説項目使用的WebView，正好我從銀行下載了計劃的csv文件，於是直接用csv2html將計劃轉成了html的table表格。然後使用Android的assets將其存儲，最終通過webview展示出來，感覺顯示效果還是蠻不錯的。</p>
<p>這次App和服務器之間的數據傳輸我封裝了一個API，數據格式是JSON，還加了一個TOKEN作爲簡單的校驗，不過論安全性還是RSA，AES來的舒服啊。</p>
<p>再説還準備改進的地方就是okhttp的多綫程問題，還有就是從服務器獲取的數據持久化本地sqlite數據庫的問題有待解決。最後一個目前能想到的容易實現的就是檢查升級功能。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://bh6aol.top/2020/04/11/Android-GridLayout-%E8%87%AA%E9%81%A9%E6%87%89/" data-id="cknhir5d300031wtvhhew9foe" data-title="Android GridLayout 自適應" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/" rel="tag">android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/" rel="tag">java</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Golang并发之道-for循环中的goroutine" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/12/16/Golang%E5%B9%B6%E5%8F%91%E4%B9%8B%E9%81%93-for%E5%BE%AA%E7%8E%AF%E4%B8%AD%E7%9A%84goroutine/" class="article-date">
  <time class="dt-published" datetime="2019-12-16T13:35:56.000Z" itemprop="datePublished">2019-12-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/12/16/Golang%E5%B9%B6%E5%8F%91%E4%B9%8B%E9%81%93-for%E5%BE%AA%E7%8E%AF%E4%B8%AD%E7%9A%84goroutine/">Golang并发之道-for循环中的goroutine</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>先看一段代码</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">	<span class="keyword">for</span> _, sal := <span class="keyword">range</span> []<span class="keyword">string</span>&#123;<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>&#125; &#123;</span><br><span class="line">		wg.Add(<span class="number">1</span>)</span><br><span class="line">		<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">			<span class="keyword">defer</span> wg.Done()</span><br><span class="line">			fmt.Println(sal)</span><br><span class="line">		&#125;()</span><br><span class="line">	&#125;</span><br><span class="line">	wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第一眼看上去程序很简单啊，就是一个for循环，每次循环时起一个goroutine啊？</p>
<p>那么执行结果应该是什么呢，慢着！goroutine不是立即起的哎！难道是乱序打印a,b,c???</p>
<p>run一下便知！</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">c</span><br><span class="line">c</span><br><span class="line">c</span><br></pre></td></tr></table></figure>

<p>为何都是c？ 难道是巧合？多跑几次试试？</p>
<p>emmmmm，实锤了，就是c！</p>
<p>哈子玩意？</p>
<p>书上这样解释：</p>
<p><strong>goroutine正在运行一个闭包，该闭包使用变量sal时，字符串迭代已经结束。</strong></p>
<p>那goroutine运行时sal从何而来？如果不幸被GC收走怎么办？</p>
<p><strong>这是一个关于如何管理内存的有趣的点。Golang运行时会足够小心的将对变量sal值的引用仍然保留，由内存转移到堆，一便goroutine可以继续访问它。</strong></p>
<p><strong>通常我们计算机上。在任何goroutine开始运行之前，循环就会退出，所以sal会被转移到堆中，即在堆中的sal为字符切片中  最后一个值c，所以通常会看到三次c。编写这个循环的正确方式是将sal的副本传递到闭包中，这样当goroutine运行时，它将从循环的迭代中操作数据。</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">	<span class="keyword">for</span> _, sal := <span class="keyword">range</span> []<span class="keyword">string</span>&#123;<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>&#125; &#123;</span><br><span class="line">		wg.Add(<span class="number">1</span>)</span><br><span class="line">		<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(sal <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">			<span class="keyword">defer</span> wg.Done()</span><br><span class="line">			fmt.Println(sal)</span><br><span class="line">		&#125;(sal)</span><br><span class="line">	&#125;</span><br><span class="line">	wg.Wait()</span><br><span class="line">&#125;</span><br><span class="line">c</span><br><span class="line">b</span><br><span class="line">a</span><br></pre></td></tr></table></figure>

<p>这下运行结果就对了（随机打印a，b，c）！</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://bh6aol.top/2019/12/16/Golang%E5%B9%B6%E5%8F%91%E4%B9%8B%E9%81%93-for%E5%BE%AA%E7%8E%AF%E4%B8%AD%E7%9A%84goroutine/" data-id="cknhir5cy00011wtvao463we9" data-title="Golang并发之道-for循环中的goroutine" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/golang/" rel="tag">golang</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Redis-Cluster" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/11/27/Redis-Cluster/" class="article-date">
  <time class="dt-published" datetime="2019-11-27T13:39:56.000Z" itemprop="datePublished">2019-11-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/11/27/Redis-Cluster/">Redis-Cluster</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>暑假期间看了一部分Redis教程，但是没有看完，昨天晚上1.5倍加速从头看完了Redis入门教程。</p>
<p>感觉应该差不多了，今天就来在WSL上模拟一下集群的搭建吧！</p>
<h3 id="1-搭建流程"><a href="#1-搭建流程" class="headerlink" title="1 搭建流程"></a>1 搭建流程</h3><p>首先看一下我的redis位置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root@DESKTOP-JUOEVVQ:&#x2F;usr&#x2F;local&#x2F;bin# ll</span><br><span class="line">total 40160</span><br><span class="line">drwxr-xr-x 1 root root    4096 Nov 27 00:51 .&#x2F;</span><br><span class="line">drwxr-xr-x 1 root root    4096 Nov 27 11:49 ..&#x2F;</span><br><span class="line">-rw-r--r-- 1 root root     349 Nov 26 23:25 dump.rdb</span><br><span class="line">-rwxr-xr-x 1 root root 4688472 Nov 26 18:37 redis-benchmark*</span><br><span class="line">-rwxr-xr-x 1 root root 8782336 Nov 26 18:37 redis-check-aof*</span><br><span class="line">-rwxr-xr-x 1 root root 8782336 Nov 26 18:37 redis-check-rdb*</span><br><span class="line">-rwxr-xr-x 1 root root 5216680 Nov 26 18:37 redis-cli*</span><br><span class="line">lrwxrwxrwx 1 root root      12 Nov 26 18:37 redis-sentinel -&gt; redis-server*</span><br><span class="line">-rwxr-xr-x 1 root root 8782336 Nov 26 18:37 redis-server*</span><br><span class="line">-rw-r--r-- 1 root root   61796 Nov 26 18:48 redis.conf</span><br></pre></td></tr></table></figure>

<p>1.1 创建Redis节点安装目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@DESKTOP-JUOEVVQ:&#x2F;usr&#x2F;local#mkdir redis_cluster</span><br></pre></td></tr></table></figure>

<p>1.2 在redis_cluster目录下，创建7001-7006个文件夹下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@DESKTOP-JUOEVVQ:&#x2F;usr&#x2F;local&#x2F;redis_cluster#mkdir 7001 7002 7003 7004 7005 7006</span><br></pre></td></tr></table></figure>

<p>1.3 并将redis.conf分别拷贝到7001-7006文件夹下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@DESKTOP-JUOEVVQ:&#x2F;usr&#x2F;local&#x2F;redis_cluster# cp ..&#x2F;bin&#x2F;redis.conf  .&#x2F;7001</span><br><span class="line">root@DESKTOP-JUOEVVQ:&#x2F;usr&#x2F;local&#x2F;redis_cluster# cp ..&#x2F;bin&#x2F;redis.conf  .&#x2F;7002</span><br><span class="line">root@DESKTOP-JUOEVVQ:&#x2F;usr&#x2F;local&#x2F;redis_cluster# cp ..&#x2F;bin&#x2F;redis.conf  .&#x2F;7003</span><br><span class="line">root@DESKTOP-JUOEVVQ:&#x2F;usr&#x2F;local&#x2F;redis_cluster# cp ..&#x2F;bin&#x2F;redis.conf  .&#x2F;7004</span><br><span class="line">root@DESKTOP-JUOEVVQ:&#x2F;usr&#x2F;local&#x2F;redis_cluster# cp ..&#x2F;bin&#x2F;redis.conf  .&#x2F;7005</span><br><span class="line">root@DESKTOP-JUOEVVQ:&#x2F;usr&#x2F;local&#x2F;redis_cluster# cp ..&#x2F;bin&#x2F;redis.conf  .&#x2F;7006</span><br></pre></td></tr></table></figure>

<p>1.4 分别修改配置文件（这里举例7001节点，其他节点类比即可）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">protected-mode no</span><br><span class="line"># bind 127.0.0.1</span><br><span class="line">port 7001</span><br><span class="line">daemonize yes</span><br><span class="line">pidfile &#x2F;var&#x2F;run&#x2F;redis_7001.pid</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes-7001.conf</span><br></pre></td></tr></table></figure>

<p>1.5 复制src到各个节点文件夹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@DESKTOP-JUOEVVQ:&#x2F;home&#x2F;michael&#x2F;redis-5.0.7# cp -r src&#x2F; &#x2F;usr&#x2F;local&#x2F;redis_cluster&#x2F;7001</span><br><span class="line">root@DESKTOP-JUOEVVQ:&#x2F;home&#x2F;michael&#x2F;redis-5.0.7# cp -r src&#x2F; &#x2F;usr&#x2F;local&#x2F;redis_cluster&#x2F;7002</span><br><span class="line">root@DESKTOP-JUOEVVQ:&#x2F;home&#x2F;michael&#x2F;redis-5.0.7# cp -r src&#x2F; &#x2F;usr&#x2F;local&#x2F;redis_cluster&#x2F;7003</span><br><span class="line">root@DESKTOP-JUOEVVQ:&#x2F;home&#x2F;michael&#x2F;redis-5.0.7# cp -r src&#x2F; &#x2F;usr&#x2F;local&#x2F;redis_cluster&#x2F;7004</span><br><span class="line">root@DESKTOP-JUOEVVQ:&#x2F;home&#x2F;michael&#x2F;redis-5.0.7# cp -r src&#x2F; &#x2F;usr&#x2F;local&#x2F;redis_cluster&#x2F;7005</span><br><span class="line">root@DESKTOP-JUOEVVQ:&#x2F;home&#x2F;michael&#x2F;redis-5.0.7# cp -r src&#x2F; &#x2F;usr&#x2F;local&#x2F;redis_cluster&#x2F;7006</span><br></pre></td></tr></table></figure>

<p>1.6 启动各个节点（这里只给出7001，其他节点类比即可）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@DESKTOP-JUOEVVQ:&#x2F;usr&#x2F;local&#x2F;redis_cluster# .&#x2F;7001&#x2F;src&#x2F;redis-server .&#x2F;7001&#x2F;redis.conf</span><br><span class="line">270:C 27 Nov 2019 12:17:22.135 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span><br><span class="line">270:C 27 Nov 2019 12:17:22.135 # Redis version&#x3D;5.0.7, bits&#x3D;64, commit&#x3D;00000000, modified&#x3D;0, pid&#x3D;270, just started       270:C 27 Nov 2019 12:17:22.135 # Configuration loaded</span><br></pre></td></tr></table></figure>

<p>完成六个节点启动后ps看一下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@DESKTOP-JUOEVVQ:&#x2F;usr&#x2F;local&#x2F;redis_cluster# ps aux | grep redis</span><br><span class="line">michael    221  0.0  0.0  52352  2236 ?        Ssl  10:26   0:00 .&#x2F;redis-server *:6379</span><br><span class="line">root       271  0.0  0.0  52352  5084 ?        Ssl  12:17   0:00 .&#x2F;7001&#x2F;src&#x2F;redis-server *:7001 [cluster]</span><br><span class="line">root       276  0.0  0.0  52352  5084 ?        Ssl  12:18   0:00 .&#x2F;7002&#x2F;src&#x2F;redis-server *:7002 [cluster]</span><br><span class="line">root       281  0.0  0.0  52352  5092 ?        Ssl  12:18   0:00 .&#x2F;7003&#x2F;src&#x2F;redis-server *:7003 [cluster]</span><br><span class="line">root       293  0.0  0.0  55424  5112 ?        Ssl  12:19   0:00 .&#x2F;7004&#x2F;src&#x2F;redis-server *:7004 [cluster]</span><br><span class="line">root       298  0.0  0.0  52352  5084 ?        Ssl  12:19   0:00 .&#x2F;7005&#x2F;src&#x2F;redis-server *:7005 [cluster]</span><br><span class="line">root       303  0.0  0.0  52352  5088 ?        Ssl  12:19   0:00 .&#x2F;7006&#x2F;src&#x2F;redis-server *:7006 [cluster]</span><br><span class="line">root       315  0.0  0.0  14804  1196 pts&#x2F;0    S    12:20   0:00 grep --color&#x3D;auto redis</span><br></pre></td></tr></table></figure>

<p>1.7 复制redis-trib.rb到/usr/local/bin</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@DESKTOP-JUOEVVQ:&#x2F;home&#x2F;michael&#x2F;redis-5.0.7&#x2F;src# cp redis-trib.rb &#x2F;usr&#x2F;local&#x2F;bin&#x2F;</span><br></pre></td></tr></table></figure>

<p>1.8 启动集群</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@DESKTOP-JUOEVVQ:&#x2F;usr&#x2F;local&#x2F;bin# redis-trib.rb create --replicas 1 127.0.0.1:7001 127.0.0.1:7002 127.0.0.1:7003 127.0.0.1:7004 127.0.0.1:7005 127.0.0.1:7006</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;env: ‘ruby’: No such file or directory</span><br></pre></td></tr></table></figure>

<p>报错没有ruby，安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@DESKTOP-JUOEVVQ:&#x2F;usr&#x2F;local&#x2F;bin# apt install ruby</span><br></pre></td></tr></table></figure>

<p>1.9 看来我看的教材老了唉</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">root@DESKTOP-JUOEVVQ:&#x2F;usr&#x2F;local&#x2F;bin# redis-trib.rb create --replicas 1 127.0.0.1:7001 127.0.0.1:7002 127.0.0.1:7003 127.0.0.1:7004 127.0.0.1:7005 127.0.0.1:7006</span><br><span class="line">WARNING: redis-trib.rb is not longer available!</span><br><span class="line">You should use redis-cli instead.</span><br><span class="line"></span><br><span class="line">All commands and features belonging to redis-trib.rb have been moved</span><br><span class="line">to redis-cli.</span><br><span class="line">In order to use them you should call redis-cli with the --cluster</span><br><span class="line">option followed by the subcommand name, arguments and options.</span><br><span class="line"></span><br><span class="line">Use the following syntax:</span><br><span class="line">redis-cli --cluster SUBCOMMAND [ARGUMENTS] [OPTIONS]</span><br><span class="line"></span><br><span class="line">Example:</span><br><span class="line">redis-cli --cluster create 127.0.0.1:7001 127.0.0.1:7002 127.0.0.1:7003 127.0.0.1:7004 127.0.0.1:7005 127.0.0.1:7006 --cluster-replicas 1</span><br><span class="line"></span><br><span class="line">To get help about all subcommands, type:</span><br><span class="line">redis-cli --cluster help</span><br></pre></td></tr></table></figure>

<p>1.10 按提示来吧</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">root@DESKTOP-JUOEVVQ:&#x2F;usr&#x2F;local&#x2F;bin# redis-cli --cluster create 127.0.0.1:7001 127.0.0.1:7002 127.0.0.1:7003 127.0.0.1:7004 127.0.0.1:7005 127.0.0.1:7006 --cluster-replicas 1 -a 123456</span><br><span class="line">Warning: Using a password with &#39;-a&#39; or &#39;-u&#39; option on the command line interface may not be safe.</span><br><span class="line">&gt;&gt;&gt; Performing hash slots allocation on 6 nodes...</span><br><span class="line">Master[0] -&gt; Slots 0 - 5460</span><br><span class="line">Master[1] -&gt; Slots 5461 - 10922</span><br><span class="line">Master[2] -&gt; Slots 10923 - 16383</span><br><span class="line">Adding replica 127.0.0.1:7005 to 127.0.0.1:7001</span><br><span class="line">Adding replica 127.0.0.1:7006 to 127.0.0.1:7002</span><br><span class="line">Adding replica 127.0.0.1:7004 to 127.0.0.1:7003</span><br><span class="line">&gt;&gt;&gt; Trying to optimize slaves allocation for anti-affinity</span><br><span class="line">[WARNING] Some slaves are in the same host as their master</span><br><span class="line">M: 081843660c373d95c6c69794da0bca23e3ef7a2a 127.0.0.1:7001</span><br><span class="line">   slots:[0-5460] (5461 slots) master</span><br><span class="line">M: d5d90d62310d8dbfa384e8bea4d0a1b3ae14035b 127.0.0.1:7002</span><br><span class="line">   slots:[5461-10922] (5462 slots) master</span><br><span class="line">M: 42cf5706c29e387d79597ee954bfdf31e43b1bfc 127.0.0.1:7003</span><br><span class="line">   slots:[10923-16383] (5461 slots) master</span><br><span class="line">S: 168711e677c7b6adef17e4779850f3387f86c41c 127.0.0.1:7004</span><br><span class="line">   replicates 42cf5706c29e387d79597ee954bfdf31e43b1bfc</span><br><span class="line">S: d04c5ecc5e79777afd32fe4fb33ddb82c938bc1c 127.0.0.1:7005</span><br><span class="line">   replicates 081843660c373d95c6c69794da0bca23e3ef7a2a</span><br><span class="line">S: bfbc2a40cc4fccf4c9f9727391d574e435c8cc05 127.0.0.1:7006</span><br><span class="line">   replicates d5d90d62310d8dbfa384e8bea4d0a1b3ae14035b</span><br><span class="line">Can I set the above configuration? (type &#39;yes&#39; to accept): yes</span><br><span class="line">&gt;&gt;&gt; Nodes configuration updated</span><br><span class="line">&gt;&gt;&gt; Assign a different config epoch to each node</span><br><span class="line">&gt;&gt;&gt; Sending CLUSTER MEET messages to join the cluster</span><br><span class="line">Waiting for the cluster to join</span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt; Performing Cluster Check (using node 127.0.0.1:7001)</span><br><span class="line">M: 081843660c373d95c6c69794da0bca23e3ef7a2a 127.0.0.1:7001</span><br><span class="line">   slots:[0-5460] (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">M: d5d90d62310d8dbfa384e8bea4d0a1b3ae14035b 127.0.0.1:7002</span><br><span class="line">   slots:[5461-10922] (5462 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">M: 42cf5706c29e387d79597ee954bfdf31e43b1bfc 127.0.0.1:7003</span><br><span class="line">   slots:[10923-16383] (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: bfbc2a40cc4fccf4c9f9727391d574e435c8cc05 127.0.0.1:7006</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates d5d90d62310d8dbfa384e8bea4d0a1b3ae14035b</span><br><span class="line">S: 168711e677c7b6adef17e4779850f3387f86c41c 127.0.0.1:7004</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 42cf5706c29e387d79597ee954bfdf31e43b1bfc</span><br><span class="line">S: d04c5ecc5e79777afd32fe4fb33ddb82c938bc1c 127.0.0.1:7005</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 081843660c373d95c6c69794da0bca23e3ef7a2a</span><br><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line">&gt;&gt;&gt; Check for open slots...</span><br><span class="line">&gt;&gt;&gt; Check slots coverage...</span><br><span class="line">[OK] All 16384 slots covered.</span><br><span class="line">root@DESKTOP-JUOEVVQ:&#x2F;usr&#x2F;local&#x2F;bin#</span><br></pre></td></tr></table></figure>

<p>成了？？？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@DESKTOP-JUOEVVQ:&#x2F;usr&#x2F;local&#x2F;redis_cluster# redis-cli -c -h 127.0.0.1 -p 7001 -a 123456</span><br><span class="line">Warning: Using a password with &#39;-a&#39; or &#39;-u&#39; option on the command line interface may not be safe.</span><br><span class="line">127.0.0.1:7001&gt; set foo bar</span><br><span class="line">-&gt; Redirected to slot [12182] located at 127.0.0.1:7003</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:7003&gt; get foo</span><br><span class="line">&quot;bar&quot;</span><br><span class="line">127.0.0.1:7003&gt;</span><br></pre></td></tr></table></figure>

<p>这里要注意一下就是如果节点设置密码的话每个节点的配置文件还要修改一下下面的配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">masterauth 123456</span><br><span class="line">requirepass 123456</span><br></pre></td></tr></table></figure>

<p>这样集群的简单测试就完成了。接下来就是java代码测试一下连接集群</p>
<h3 id="2-Java连接测试"><a href="#2-Java连接测试" class="headerlink" title="2 Java连接测试"></a>2 Java连接测试</h3><p>这里遇到的主要问题就是jedisCluster.auth()用不了了</p>
<p>后来发现在构造里面有带密码的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">JedisCluster</span><span class="params">(Set&lt;HostAndPort&gt; jedisClusterNode, <span class="keyword">int</span> connectionTimeout, <span class="keyword">int</span> soTimeout,</span></span></span><br><span class="line"><span class="function"><span class="params">                      <span class="keyword">int</span> maxAttempts, String password, <span class="keyword">final</span> GenericObjectPoolConfig poolConfig)</span> </span></span><br></pre></td></tr></table></figure>

<p>拿来试试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Jedis Cluster Test Demo</span></span><br><span class="line"><span class="comment">     * Michael Jiang</span></span><br><span class="line"><span class="comment">     * 2019年11月27日 13点24分</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">testJedisCluser</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Set&lt;HostAndPort&gt; nodes = <span class="keyword">new</span> HashSet&lt;HostAndPort&gt;();</span><br><span class="line">        nodes.add(<span class="keyword">new</span> HostAndPort(<span class="string">&quot;192.168.235.1&quot;</span>,<span class="number">7001</span>));</span><br><span class="line">        nodes.add(<span class="keyword">new</span> HostAndPort(<span class="string">&quot;192.168.235.1&quot;</span>,<span class="number">7002</span>));</span><br><span class="line">        nodes.add(<span class="keyword">new</span> HostAndPort(<span class="string">&quot;192.168.235.1&quot;</span>,<span class="number">7003</span>));</span><br><span class="line">        nodes.add(<span class="keyword">new</span> HostAndPort(<span class="string">&quot;192.168.235.1&quot;</span>,<span class="number">7004</span>));</span><br><span class="line">        nodes.add(<span class="keyword">new</span> HostAndPort(<span class="string">&quot;192.168.235.1&quot;</span>,<span class="number">7005</span>));</span><br><span class="line">        nodes.add(<span class="keyword">new</span> HostAndPort(<span class="string">&quot;192.168.235.1&quot;</span>,<span class="number">7006</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 因为到目前jedis还不兹磁直接设置带密码的集群访问，所以需要使用poolconfig</span></span><br><span class="line">        JedisPoolConfig poolConfig = <span class="keyword">new</span> JedisPoolConfig();</span><br><span class="line"></span><br><span class="line">        JedisCluster jedisCluster = <span class="keyword">new</span> JedisCluster(nodes,<span class="number">1000</span>,<span class="number">1000</span>,<span class="number">100</span>,<span class="string">&quot;123456&quot;</span>,poolConfig);</span><br><span class="line"></span><br><span class="line">        String foo = jedisCluster.get(<span class="string">&quot;foo&quot;</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(foo);</span><br><span class="line"></span><br><span class="line">        jedisCluster.close();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>运行结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bar</span><br></pre></td></tr></table></figure>

<p>吼以了！</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://bh6aol.top/2019/11/27/Redis-Cluster/" data-id="cknhir5d8000a1wtva2ljh5hy" data-title="Redis-Cluster" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/redis/" rel="tag">redis</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-MIME测试" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/11/23/MIME%E6%B5%8B%E8%AF%95/" class="article-date">
  <time class="dt-published" datetime="2019-11-23T13:46:09.000Z" itemprop="datePublished">2019-11-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/11/23/MIME%E6%B5%8B%E8%AF%95/">MIME测试</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote>
<p><strong>多用途互联网邮件扩展</strong>（英语：<strong>M</strong>ultipurpose <strong>I</strong>nternet <strong>M</strong>ail <strong>E</strong>xtensions，缩写：<strong>MIME</strong>）是一个<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E4%BA%92%E8%81%94%E7%BD%91%E6%A0%87%E5%87%86">互联网标准</a>，它扩展了<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E7%94%B5%E5%AD%90%E9%82%AE%E4%BB%B6">电子邮件</a>标准，使其能够支持：</p>
<ul>
<li>非<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/ASCII">ASCII</a>字符文本；</li>
<li>非文本格式附件（<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E4%BA%8C%E8%BF%9B%E5%88%B6">二进制</a>、声音、图像等）；</li>
<li>由多部分（multiple parts）组成的消息体；</li>
<li>包含非<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/ASCII">ASCII</a>字符的头信息（Header information）。这个标准被定义在 <a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc2045">RFC 2045</a>、<a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc2046">RFC 2046</a>、<a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc2047">RFC 2047</a>、<a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc2048">RFC 2048</a>、<a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc2049">RFC 2049</a> 等<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/RFC">RFC</a>中。</li>
</ul>
<p>MIME改善了由 <a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc822">RFC 822</a> 转变而来的 <a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc2822">RFC 2822</a> ，这些旧标准规定<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E7%94%B5%E5%AD%90%E9%82%AE%E4%BB%B6">电子邮件</a>标准并不允许在邮件消息中使用7位ASCII字符集以外的字符。正因如此，一些非英语字符消息和二进制文件，图像，声音等非文字消息原本都不能在电子邮件中传输（MIME可以）。MIME规定了用于表示各种各样的数据类型的符号化方法。此外，在<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E4%B8%87%E7%BB%B4%E7%BD%91">万维网</a>中使用的<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E8%B6%85%E6%96%87%E6%9C%AC%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE">HTTP协议</a>中也使用了MIME的框架，标准被扩展为<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E4%BA%92%E8%81%94%E7%BD%91%E5%AA%92%E4%BD%93%E7%B1%BB%E5%9E%8B">互联网媒体类型</a>。</p>
</blockquote>
<p>上学期写的senCQ（Java特别版）当时准备使用但由于时间仓促没有仔细研究就无脑切后缀了；现在回过头来研究一下。</p>
<p>发现MIME的Java官方实现也几乎是更具后缀猜嘛？</p>
<p>对于这些你能想到的功能不要一上来就想着自己造轮子（当然如果时间允许，自己造个轮子又何妨？）</p>
<p>首先我们要看一下这个功能官方是否已经实现？比如base64编码，官网已经实现；而我却不知道跑去apache下codec多跑冤枉路！</p>
<p>如果官方已经帮我们办好的话，并且官方的轮子可以在我们的应用场景下转起来；那么就官方即可。</p>
<p>如果官方没有轮子或者官方的轮子不是很好，那么我们就得找第三方的轮子了！</p>
<p>最后！！！很不幸，没有找到第三方轮子，亦或是第三方的轮子根本转不了，这时候你可以尝试修复一下别人的轮子（上次闲着写了个senMusic）找了个网上找了个lrc-parser的轮子，结果转的不是很顺溜，简单修复一下就OK了；如果没有别人的轮子，那就自己动手，丰衣足食！</p>
<p>说了这么多，直接进入正题吧！直接看代码，一目了然！</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.company;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Path;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">	<span class="comment">// write your code here</span></span><br><span class="line">        Path path = Paths.get(<span class="string">&quot;D:/未命名.html&quot;</span>);</span><br><span class="line">        System.out.println(Files.probeContentType(path));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">text/html</span><br><span class="line"></span><br><span class="line">Process finished with exit code <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>结果如上！！！</p>
<p>但是当我把文件后缀名改为exe结果又如下所示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">application&#x2F;x-msdownload</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<p>所以说嘛，只是简单的后缀判断，猜测而已不然为啥叫**<code>probeContentType</code>**</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://bh6aol.top/2019/11/23/MIME%E6%B5%8B%E8%AF%95/" data-id="cknhir5d500051wtv9vlq7uvv" data-title="MIME测试" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/" rel="tag">java</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&laquo; 上一页</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/">下一页 &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/adb/" rel="tag">adb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/algo/" rel="tag">algo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android/" rel="tag">android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/assembly/" rel="tag">assembly</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/c/" rel="tag">c</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/debian/" rel="tag">debian</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/django/" rel="tag">django</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/eclipse/" rel="tag">eclipse</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/error/" rel="tag">error</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/golang/" rel="tag">golang</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/junit/" rel="tag">junit</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/maven/" rel="tag">maven</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mybatis/" rel="tag">mybatis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pip/" rel="tag">pip</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/project/" rel="tag">project</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pyhthon/" rel="tag">pyhthon</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/raspberrypi/" rel="tag">raspberrypi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/" rel="tag">redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rsa/" rel="tag">rsa</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spring/" rel="tag">spring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/springboot/" rel="tag">springboot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/springsecurity/" rel="tag">springsecurity</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows/" rel="tag">windows</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/adb/" style="font-size: 10px;">adb</a> <a href="/tags/algo/" style="font-size: 14px;">algo</a> <a href="/tags/android/" style="font-size: 16px;">android</a> <a href="/tags/assembly/" style="font-size: 10px;">assembly</a> <a href="/tags/c/" style="font-size: 18px;">c</a> <a href="/tags/debian/" style="font-size: 10px;">debian</a> <a href="/tags/django/" style="font-size: 12px;">django</a> <a href="/tags/eclipse/" style="font-size: 12px;">eclipse</a> <a href="/tags/error/" style="font-size: 14px;">error</a> <a href="/tags/git/" style="font-size: 12px;">git</a> <a href="/tags/golang/" style="font-size: 10px;">golang</a> <a href="/tags/java/" style="font-size: 20px;">java</a> <a href="/tags/junit/" style="font-size: 10px;">junit</a> <a href="/tags/linux/" style="font-size: 16px;">linux</a> <a href="/tags/maven/" style="font-size: 12px;">maven</a> <a href="/tags/mybatis/" style="font-size: 12px;">mybatis</a> <a href="/tags/pip/" style="font-size: 10px;">pip</a> <a href="/tags/project/" style="font-size: 10px;">project</a> <a href="/tags/pyhthon/" style="font-size: 10px;">pyhthon</a> <a href="/tags/python/" style="font-size: 12px;">python</a> <a href="/tags/raspberrypi/" style="font-size: 10px;">raspberrypi</a> <a href="/tags/redis/" style="font-size: 12px;">redis</a> <a href="/tags/rsa/" style="font-size: 10px;">rsa</a> <a href="/tags/spring/" style="font-size: 10px;">spring</a> <a href="/tags/springboot/" style="font-size: 10px;">springboot</a> <a href="/tags/springsecurity/" style="font-size: 10px;">springsecurity</a> <a href="/tags/windows/" style="font-size: 12px;">windows</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">五月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">四月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">二月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">一月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">八月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">五月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">四月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">十二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">十一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">八月 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/05/09/springsecurity%E9%83%A8%E5%88%86%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E6%97%A0%E6%B3%95%E5%8A%A0%E8%BD%BD/">springsecurity部分静态资源无法加载</a>
          </li>
        
          <li>
            <a href="/2021/04/24/%E6%8A%A5%E9%94%99-java-%E7%A8%8B%E5%BA%8F%E5%8C%85org-springframework-boot-autoconfigure/">报错:java:程序包org.springframework.boot.autoconfigure</a>
          </li>
        
          <li>
            <a href="/2021/04/22/Eclipse-%E6%96%AD%E7%82%B9%E8%B0%83%E8%AF%95%E6%8A%80%E5%B7%A7/">Eclipse 断点调试技巧</a>
          </li>
        
          <li>
            <a href="/2021/04/21/Eclipse-web-%E9%A1%B9%E7%9B%AE%E4%B8%8D%E7%BC%96%E8%AF%91%E9%97%AE%E9%A2%98/">Eclipse web 项目不编译问题</a>
          </li>
        
          <li>
            <a href="/2021/04/18/List%E6%8C%89%E8%A7%84%E5%88%99%E5%88%A0%E9%99%A4%E5%85%83%E7%B4%A0/">List按规则删除元素</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 BH6AOL<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>